# Lesson 19 - User Authentication

## LEARN

### User Authentication

* User authentication is hard to get right
* Django provides powerful built-in tools
* We extend the Django implementation


### User Object
* username
* password
* email
* first_name
* last_name


### Forms and Logic
* Log in
* Log out
* Sign up
* User status


### Log In

config/urls.py

    from django.contrib import admin
    from django.urls import path, include

    urlpatterns = [
        path('admin/', admin.site.urls),
        path('accounts/', include('django.contrib.auth.urls')),
        path('', 
            TemplateView.as_view(template_name="templates/home.html"), 
            name='home'),
    ]


config/settings.py

    LOGIN_REDIRECT_URL = 'home'


template/registration/login.html

    {% extends 'base.html' %}

    {% block content %}
        <h2>Log In</h2>
        <form method="post">
              {% csrf_token %}
              {{ form.as_p }}
              <button type="submit">Log In</button>
        </form>
    {% endblock content %}


### User status

templates/base.html

    {% if user.is_authenticated %}
        <p>Hi {{ user.username }}!</p>
        <p><a href="{% url 'logout' %}">Log out</a></p>
    {% else %}
        <p>You are not logged in.</p>
        <a href="{% url 'login' %}">Log In</a>
    {% endif %}



### Home Page

templates/base.html

    <html>
      <head>
        <title>User Authentication Demo</title>
        <link href="/static/css/base.css" rel="stylesheet"s>
      </head>
      <body>
          <header>
              <h1><a href="{% url 'home' %}">Home Page</a></h1>

              {% if user.is_authenticated %}
                    <p>Hi {{ user.username }}!</p>
                    <p><a href="{% url 'logout' %}">Log out</a></p>
              {% else %}
                    <p>You are not logged in.</p>
                    <a href="{% url 'login' %}">Log In</a>
              {% endif %}
          </header>

          {% block content %}
          {% endblock content %}
      </body>
    </html>



### Log out
Follow this link to log out

    <a href="{% url 'logout' %}">Log out</a>

config/settings.py

    LOGOUT_REDIRECT_URL = 'home'


### Sign up

Create a new app

    $ python manage.py startapp accounts

config/settings.py

    INSTALLED_APPS = [..., 'accounts', ]


config/urls.py

    urlpatterns = [
        ...
        path('accounts/', include('accounts.urls')),
        ...
    ]


accounts/urls.py

    from django.urls import path
    from .views import SignUpView

    urlpatterns = [
        path('signup/', SignUpView.as_view(), name='signup'),
    ]


accounts/views.py

    from django.urls import reverse_lazy
    from django.views import generic


    class SignUpView(generic.CreateView):
        form_class = UserCreationForm
        success_url = reverse_lazy('login')
        template_name = 'registration/signup.html'


templates/sign_up.html

    {% extends 'base.html' %}

    {% block content %}
        <h2>Sign Up</h2>
        <form method="post">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit">Sign Up</button>
        </form>
    {% endblock content %}


