# Lesson 15 - Forms for Data


## LEARN

### Admin Views
* Provide forms for creating and modifying records
* Logic for updating the database
* Views
    * TemplateView
    * ListView
    * DetailView


### Using Forms
* Security - login permission, CSRF
* Authenticated users only can modify data
* Prevent hackers from booking info


### Cross-Site Request Forgery
* Hacker can book a form to your website
* Web forms come from web server
* Books must contain a token from the server
* All logic is provided by Django




## BUILD

### Book Builder Demo
* Follow along with [Book Builder](https://github.com/Mark-Seaman/BACS350/tree/main/week6)
* Use these concepts on your Superhero app


### Create Week6 code
* Use week5 as a starting point
* Test current status
* New Features
    * Add CreateView
    * Add UpdateView
    * Add DeleteView


### Data Model Design Pattern 

book/models.py

    from django.db import models
    
    class Book(models.Model):
        title = models.CharField(max_length=200)
        author = models.ForeignKey('auth.User', on_delete=models.CASCADE)
        body = models.TextField()
    

### CreateView Design Pattern 

templates/book_new.html

```

    <form action="" method="book">{% csrf_token %}
       {{ form.as_p }}
       <input type="submit" value="Save">
    </form>
```


config/urls.py

    from django.urls import path
    from book.views import BookCreateView
    
    urlpatterns = [
        path('new/', BookCreateView.as_view(), name='book-new'),
    ]

book/views.py
        
    class BookCreateView(CreateView):
        model = Book
        template_name = 'book_new.html'
        fields = ['title', 'author']
    

### ListView Design Pattern 

templates/book_list.html

```
    {% for book in object_list %}
        <h3><a href="{% url 'book-detail' book.pk %}">{{ book.title }}</a></h3>
        <p>by {{ book.author }}</p>
    {% endfor %}
```   

blog/urls.py

    urlpatterns = [
        path('', BookListView.as_view(), name='book-list'),
    ]
    
blog/views.py

    class BookListView(ListView):
        model = Book
        template_name = 'book_list.html'
 


### DetailView Design Pattern 

templates/book_detail.html

```   
    <h2>{{ book.title }}</h2>
    <p>{{ book.author }}</p>
    
    <a href="{% url 'book-edit' book.pk %}">Edit Book Book</a>
    <a href="{% url 'book-delete' book.pk %}">Delete Book Book</a>
``` 

blog/urls.py

    urlpatterns = [
        path('<int:pk>/', BookDetailView.as_view(), name='book-detail'),
    ]

blog/views.py

    class BookDetailView(DetailView):
        model = Book
        template_name = 'book-detail.html'
    


### UpdateView Design Pattern

templates/book_edit.html

```
    <form action="" method="book">{% csrf_token %}
        {{ form.as_p }}
        <input type="submit" value="Update">
    </form>
```

blog/urls.py

    urlpatterns = [
        path('<int:pk>/edit/', BookUpdateView.as_view(), name='book_edit'),
    ]

blog/views.py

    class BookUpdateView(UpdateView):
        model = Book
        template_name = 'book-edit.html'
        fields = ['title', 'author']
    
    

### DeleteView Design Pattern

templates/book_delete.html

```
    <h2>{{ book.title }}</h2>
    <p>{{ book.author }}</p>
    
    <a href="{% url 'book-edit' book.pk %}">Edit Book Book</a>
    <a href="{% url 'book-delete' book.pk %}">Delete Book Book</a>
```

blog/urls.py

    urlpatterns = [
        path('<int:pk>/delete/', BookDeleteView.as_view(), name='book-delete'),
    ]

blog/views.py

    from django.urls import reverse_lazy

    class BookDeleteView(DeleteView):
        model = Book
        template_name = 'book_delete.html'
        success_url = reverse_lazy('book-list')

